function Options(e,t,n){this.apiKey=e;this.appId=t;this.updateFreq=n||Options.DEFAULT_UPDATE_FREQ}function displayKeyError(e){$("#api-key-error").text(e);$("#api-key-error-container").addClass("error");$("#api-key-error").show()}function clearKeyError(){$("#api-key-error").hide();$("#api-key-error").text("");$("#api-key-error-container").removeClass("error")}function populateAppList(){var e=$("#api-key").val();$("#app-selector").prop("disabled",true);$("#app-selector").val("").change();if(!e){displayKeyError("Please enter your API key.");return}else{displayKeyError("Checking key...")}$.ajax({url:NEWRELIC_API_URL+"/applications.json",headers:{"X-Api-Key":e},dataType:"json",timeout:AJAX_TIMEOUT}).done(function(e){clearKeyError();$("#app-selector").empty();$("#app-selector").val("").change();$(e["applications"]).each(function(){$("<option />",{val:this["id"],text:this["name"]}).appendTo($("#app-selector"))});$("#app-selector").prop("disabled",false);var t=Options.getSavedOptions();$("#app-selector").val(t.appId).change()}).fail(function(e,t,n){$("#app-selector").empty();$("#app-selector").val("").change();console.log("Failed to fetch New Relic app list: "+n);console.log(e.status);switch(e.status){case 401:displayKeyError("Invalid API key!");break;case 403:displayKeyError("New Relic API access has not been enabled.");break;default:displayKeyError("Unable to fetch New Relic app list!");break}})}NEWRELIC_API_URL="https://api.newrelic.com/v2";AJAX_TIMEOUT=3e4;Options.DEFAULT_UPDATE_FREQ=5;Options.prototype.display=function(){console.log("Loaded options: "+JSON.stringify(this));$("#api-key").val(this.apiKey);$("#app-selector").val(this.appId).change();$("#update-freq").val(this.updateFreq||Options.DEFAULT_UPDATE_FREQ)};Options.getCurrentOptions=function(){return new Options($("#api-key").val(),$("#app-selector").val(),$("#update-freq").val())};Options.getSavedOptions=function(){var e=JSON.parse(decodeURIComponent(window.location.hash.substring(1))||"{}");e.__proto__=Options.prototype;return e};$("document").ready(function(){Options.getSavedOptions().display();populateAppList()});$("document").ready(function(){$("#cancel-button").click(function(){console.log("Configuration cancelled.");document.location="pebblejs://close"});$("#save-button").click(function(){var e="pebblejs://close#"+encodeURIComponent(JSON.stringify(Options.getCurrentOptions()));console.log("Saving configuration...");document.location=e});$("#api-key").change(function(){$(this).val($(this).val().replace(/[^a-z0-9]/gi,""));populateAppList()});$("#app-selector").change(function(){if($(this).val()){$("#save-button").prop("disabled",false)}else{$("#save-button").prop("disabled",true)}});$("#update-freq").change(function(){var e=parseInt($(this).val());if(e&&e>=1){$(this).val(e)}else{$(this).val(Options.DEFAULT_UPDATE_FREQ)}})})
